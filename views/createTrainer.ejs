<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title><%= title %></title>
    </head>
    <body>
        <h1><%= title %></h1>
        <form action="/create" method="post">
            <label for="name">Trainer Name:</label>
            <input type="text" name="name" id="name" />
            <label for="trainer-sprite">Select your Trainer Sprite:</label>
            <select
                name="sprite"
                id="trainer-sprite"
                onchange="document.getElementById('trainerSpriteImage').src = '/assets/trainer-sprites/' + this.options[this.selectedIndex].dataset.img || '/assets/trainer-sprites/Spr_DP_Ace_Trainer_F_1.png';"
            >
                <% trainerSprites.forEach(s => { %>
                <option value="<%= s.id %>" data-img="<%= s.sprite %>">
                    <%= s.name %>
                </option>
                <% }) %>
            </select>

            <img
                id="trainerSpriteImage"
                src="/assets/trainer-sprites/Spr_DP_Ace_Trainer_F_1.png"
                alt="Selected Sprite"
                style="display: block; width: 200px"
            />

            <h2>Select your Pokémon</h2>
            <datalist id="pokemonList">
                <option value="">--- None ---</option>
                <% pokemon.forEach(p => { %>
                <option value="<%= p.id %>" data-img="<%= p.sprite %>">
                    <%= p.name %>
                </option>
                <% }); %>
            </datalist>

            <div class="pokemon-team">
                <% for (let i = 0; i < 6; i++) { %>
                <label for="pokemon<%= i+1 %>">Slot <%= i+1 %>:</label>
                <input
                    list="pokemonList"
                    name="pokemon<%= i+1 %>"
                    id="pokemon<%= i+1 %>"
                    onchange="
                        const input = this;
                        const list = document.getElementById('pokemonList');
                        const img = document.getElementById('pokemonSprite<%= i+1 %>');
                        const audio = document.getElementById('pokemonAudio<%= i+1 %>');
                        const source = audio.querySelector('source');
                        const option = Array.from(list.options).find(o =>
                            o.value === input.value || o.textContent.trim() === input.value
                        );

                        if (option) {
                            img.src = option.dataset.img;
                            img.style = 'cursor: pointer; display: block; width: 150px;';
                            source.src = `https://raw.githubusercontent.com/PokeAPI/cries/main/cries/pokemon/latest/${option.value}.ogg`;
                            audio.load();
                        } else {
                            img.style = 'display: none;';
                            source.src = '';
                            audio.load();
                        }
                    "
                /><br />
                

                <img
                    id="pokemonSprite<%= i+1 %>"
                    src=""
                    alt="Selected Pokémon"
                    onclick="const pokemonAudio = document.getElementById('pokemonAudio<%= i+1 %>'); pokemonAudio.volume = 0.5; pokemonAudio.play();"
                    style="display: none;"
                />
                <audio id="pokemonAudio<%= i+1 %>">
                    <source
                        src="https://raw.githubusercontent.com/PokeAPI/cries/main/cries/pokemon/latest/<%= pokemon.id %>.ogg"
                        type="audio/ogg"
                    />
                    Your browser does not support the audio element.
                </audio>
                <% } %>
            </div>
            <button type="submit">Submit</button>
        </form>
    </body>
</html>
